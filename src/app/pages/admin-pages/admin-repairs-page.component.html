<div class="container mt-4">
  <div class="mb-4 entity-header">
    <h2>
      Manage Repairs
    </h2>
    <div>
      <!-- Back Button -->
      <button class="btn btn-secondary mb-3" (click)="backToHome()">
        <i class="bi bi-arrow-left-circle me-2"></i> Back
      </button>
    </div>
  </div>


  <!-- Search and Add Repair Section -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <!-- Search Input -->
    <div class="input-group w-50">
      <span class="input-group-text" id="search-icon">
        <i class="bi bi-search"></i>
      </span>
      <input type="text" class="form-control" placeholder="Search by Repair Type, Status, Property ID, etc..."
        aria-label="Search" aria-describedby="search-icon" [(ngModel)]="searchTerm" (input)="onSearch()" />
      <button class="btn btn-outline-secondary" type="button" (click)="clearSearch()" aria-label="Clear search">
        <i class="bi bi-x-circle"></i>
      </button>
    </div>

    <!-- Add Repair Button -->
    <button class="btn btn-success" (click)="navigateToCreateRepair()">
      <i class="bi bi-plus-circle me-2"></i> Add Repair
    </button>
  </div>

  <!-- Loading Indicator -->
  <div *ngIf="isLoading" class="text-center my-5">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Loading...</span>
    </div>
  </div>

  <!-- Repairs Table -->
  <div class="table-responsive" *ngIf="!isLoading">
    <table class="table table-striped table-hover align-middle">
      <thead class="table-dark">
        <tr>
          <th scope="col" (click)="sortTable('id')">
            ID
            <i [ngClass]="getSortIcon('id')"></i>
          </th>
          <th scope="col" (click)="sortTable('repairType')">
            Repair Type
            <i [ngClass]="getSortIcon('repairType')"></i>
          </th>
          <th scope="col" (click)="sortTable('repairStatus')">
            Repair Status
            <i [ngClass]="getSortIcon('repairStatus')"></i>
          </th>
          <th scope="col" (click)="sortTable('cost')">
            Cost
            <i [ngClass]="getSortIcon('cost')"></i>
          </th>
          <th scope="col" (click)="sortTable('description')">
            Description
            <i [ngClass]="getSortIcon('description')"></i>
          </th>
          <th scope="col" (click)="sortTable('propertyId')">
            Property ID
            <i [ngClass]="getSortIcon('propertyId')"></i>
          </th>
          <th scope="col">
            Actions
          </th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let repair of filteredRepairs | paginate: { itemsPerPage: itemsPerPage, currentPage: p }; let i = index">
          <td>{{repair.id}}</td>
          <td>{{repair.repairType}}</td>
          <td>{{repair.repairStatus}}</td>
          <td>{{repair.cost | currency}}</td>
          <td>{{repair.description}}</td>
          <td>{{repair.property.id}}</td>
          <td>
            <button class="btn btn-sm btn-warning me-2" (click)="updateRepair(repair)" aria-label="Update Repair">
              <i class="bi bi-pencil-square me-1"></i> Update
            </button>
            <button class="btn btn-sm btn-danger" (click)="deleteRepair(repair)" aria-label="Delete Repair">
              <i class="bi bi-trash-fill me-1"></i> Delete
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Pagination Controls -->
  <div class="d-flex justify-content-center mt-4 customer-pagination-control-active" *ngIf="!isLoading && filteredRepairs.length > 0">
    <pagination-controls (pageChange)="p = $event"></pagination-controls>
  </div>

  <!-- No Results Message -->
  <div *ngIf="!isLoading && filteredRepairs.length === 0" class="text-muted text-center mt-5">
    No repairs match your search criteria.
  </div>
</div>